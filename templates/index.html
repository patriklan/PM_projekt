{% extends 'base.html' %}

{% block head %}
<style>
    .matrix-container { display: flex; gap: 20px; }
    .matrix { text-align: center; }
    table { margin-bottom: 10px; }
    input { width: 60px; text-align: center; }
    button { margin: 5px; padding: 8px 12px; cursor: pointer; }
    button:disabled { background-color: lightgray; cursor: not-allowed; }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Prevent form submission with Enter key
        $(document).on('keydown', 'input', function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
            }
        });

        // Matrix operation buttons
        $(".operation-btn").click(function() {
            let operation = $(this).data('operation');
            $.ajax({
                url: "/operation",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ operation: operation }),
                success: function(response) {
                    if (response.result_matrix) {
                        updateResultMatrix(response.result_matrix);
                    } else {
                        alert(response.error || 'Unknown error');
                    }
                }
            });
        });

        function updateResultMatrix(result) {
            let resultTable = '<table border="1">';
            result.forEach(row => {
                resultTable += '<tr>';
                row.forEach(cell => {
                    resultTable += `<td>${cell}</td>`;
                });
                resultTable += '</tr>';
            });
            resultTable += '</table>';
            $('#result-matrix').html(resultTable);
        }
    });
</script>
{% endblock %}

{% block body %}
<h1>Matrix Operations</h1>

<div class="matrix-container">
    <div class="matrix">
        <h2>Matrix A</h2>
        <form id="matrixA-form" action="/" method="POST">
            <table border="1">
                {% for row in range(rowa) %}
                    <tr>
                        {% for col in range(cola) %}
                            <td><input size="3" type="number" name="a_{{ row }}_{{ col }}" value="{{ matrix_a[row][col] }}" /></td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
            <button type="submit" name="action" value="add_row_a">Add Row</button>
            <button type="submit" name="action" value="remove_row_a">Remove Row</button>
            <button type="submit" name="action" value="add_column_a">Add Column</button>
            <button type="submit" name="action" value="remove_column_a">Remove Column</button>
        </form>
    </div>

    <div class="matrix">
        <h2>Matrix B</h2>
        <form id="matrixB-form" action="/" method="POST">
            <table border="1">
                {% for row in range(rowb) %}
                    <tr>
                        {% for col in range(colb) %}
                            <td><input size="3" type="number" name="b_{{ row }}_{{ col }}" value="{{ matrix_b[row][col] }}" /></td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
            <button type="submit" name="action" value="add_row_b">Add Row</button>
            <button type="submit" name="action" value="remove_row_b">Remove Row</button>
            <button type="submit" name="action" value="add_column_b">Add Column</button>
            <button type="submit" name="action" value="remove_column_b">Remove Column</button>
        </form>
    </div>

    <div class="matrix">
        <h2>Result</h2>
        <div id="result-matrix">
            <table border="1">
                {% for row in result_matrix %}
                    <tr>
                        {% for col in row %}
                            <td>{{ col }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>

<div>
    <button class="operation-btn" data-operation="add">Add Matrices</button>
    <button class="operation-btn" data-operation="subtract">Subtract Matrices</button>
    <button class="operation-btn" data-operation="multiply">Multiply Matrices</button>
    <button class="operation-btn" data-operation="transpose_a">Transpose Matrix A</button>
    <button class="operation-btn" data-operation="transpose_b">Transpose Matrix B</button>
</div>
{% endblock %}
